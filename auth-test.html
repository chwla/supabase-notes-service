<!DOCTYPE html>
<html>
<head>
  <title>Supabase Auth Test</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; }
    input { padding: 8px; width: 300px; }
    button { padding: 10px 15px; background: #3ECF8E; border: none; color: white; cursor: pointer; }
    .error { color: red; margin-top: 10px; }
    #debug { margin-top: 20px; padding: 10px; background: #f5f5f5; display: none; }
  </style>
</head>
<body>
  <h1>Get Supabase Auth Token</h1>
  
  <div class="form-group">
    <label for="supabaseUrl">Supabase URL:</label>
    <input id="supabaseUrl" type="text" placeholder="https://abcdefghijklm.supabase.co">
  </div>
  
  <div class="form-group">
    <label for="supabaseKey">Supabase Anon Key:</label>
    <input id="supabaseKey" type="text" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6...">
  </div>
  
  <div class="form-group">
    <label for="email">Email:</label>
    <input id="email" type="email">
  </div>
  
  <div class="form-group">
    <label for="password">Password:</label>
    <input id="password" type="password">
  </div>
  
  <button onclick="signIn()">Sign In</button>
  <div id="errorMsg" class="error"></div>
  
  <div class="form-group">
    <h2>Your Token:</h2>
    <textarea id="token" rows="5" cols="50"></textarea>
  </div>
  
  <button onclick="toggleDebug()">Show/Hide Debug Info</button>
  <div id="debug"></div>

  <script>
    async function signIn() {
      try {
        document.getElementById('errorMsg').innerText = '';
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const supabaseUrl = document.getElementById('supabaseUrl').value;
        const supabaseKey = document.getElementById('supabaseKey').value;
        
        if (!supabaseUrl || !supabaseKey) {
          document.getElementById('errorMsg').innerText = 'Supabase URL and Anon Key are required';
          return;
        }
        
        if (!email || !password) {
          document.getElementById('errorMsg').innerText = 'Email and password are required';
          return;
        }
        
        // Log configuration (not the key)
        console.log('Connecting to Supabase at:', supabaseUrl);
        
        // Create Supabase client
        const { createClient } = supabase;
        const client = createClient(supabaseUrl, supabaseKey);
        
        // Attempt sign in
        console.log('Attempting to sign in with email:', email);
        const { data, error } = await client.auth.signInWithPassword({
          email: email,
          password: password
        });
        
        if (error) {
          console.error('Sign in error:', error);
          document.getElementById('errorMsg').innerText = 'Error: ' + error.message;
          document.getElementById('debug').innerText = 'Full error: ' + JSON.stringify(error, null, 2);
          document.getElementById('debug').style.display = 'block';
          return;
        }
        
        if (!data || !data.session) {
          document.getElementById('errorMsg').innerText = 'Error: No session data returned';
          return;
        }
        
        console.log('Sign in successful:', data);
        document.getElementById('token').value = data.session.access_token;
        document.getElementById('debug').innerText = 'Session data: ' + JSON.stringify(data.session, null, 2);
      } catch (err) {
        console.error('Unexpected error:', err);
        document.getElementById('errorMsg').innerText = 'Unexpected error: ' + err.message;
        document.getElementById('debug').innerText = err.stack || err.toString();
        document.getElementById('debug').style.display = 'block';
      }
    }
    
    function toggleDebug() {
      const debug = document.getElementById('debug');
      debug.style.display = debug.style.display === 'none' ? 'block' : 'none';
    }
  </script>
</body>
</html>